{% load widget_tweaks %}
{{ formset.management_form }}
<table class="table table-sm">
  <thead>
    <tr>
      <th>Days</th>
      <th>Start</th>
      <th>End</th>
      <th class="w-full"></th>
    </tr>
  </thead>
  <tbody>
    {% for form in formset %}
      {{ form.id }}
      {{ form.timeslot }}
      <tr>
        <td>{% render_field form.days %}</td>
        <td>{% render_field form.start class+="input input-bordered input-sm w-20" %}</td>
        <td>{% render_field form.end class+="input input-bordered input-sm w-20" %}</td>
        <td>
          <label class="cursor-pointer">
            {% render_field form.DELETE class+="hidden peer delete-check" onchange="toggleDeleteRow(this)" %}
            <span class="flex items-center gap-2 text-base-content/60 peer-checked:hidden">
              <i class="fa-regular fa-trash-can"></i> Delete
            </span>
            <span class="hidden items-center gap-2 text-error peer-checked:flex">
              <i class="fa-solid fa-trash-can"></i> Keep
            </span>
          </label>
        </td>
      </tr>
      {% if form.errors %}
        <tr>
          <td colspan="4" class="pt-0">
            {% for field, errors in form.errors.items %}
              {% for error in errors %}<span class="text-error text-xs">{{ field|capfirst }}: {{ error }}</span>{% endfor %}
            {% endfor %}
          </td>
        </tr>
      {% endif %}
    {% endfor %}
  </tbody>
</table>
<script>
function toggleDeleteRow(checkbox) {
  const tr = checkbox.closest("tr");
  tr.querySelectorAll("td:not(:last-child)").forEach(td =>
    td.classList.toggle("opacity-40", checkbox.checked)
  );
  tr.querySelectorAll("input:not(.delete-check)").forEach(input =>
    input.disabled = checkbox.checked
  );
}
document.querySelectorAll(".delete-check").forEach(cb => toggleDeleteRow(cb));
</script>
