<!-- htmx/templates/htmx/incident/cells/_incident_maintenance.html -->
{% with tasks=incident.planned_maintenance_tasks.all %}
  {% if tasks %}
    <div class="dropdown dropdown-hover dropdown-bottom dropdown-end">
      <button tabindex="0"
              class="btn btn-ghost btn-sm cursor-pointer flex items-center gap-1 text-primary">
        <i class="fa-solid fa-person-digging"></i>
        <span class="text-xs">{{ tasks|length }} task{{ tasks|length|pluralize }}</span>
      </button>
      <div tabindex="0"
           class="dropdown-content bg-base-100 rounded-box z-20 w-72 p-2 shadow-lg flex flex-col gap-1">
        <span class="text-xs font-medium opacity-60 px-2">Planned Maintenance</span>
        {% for task in tasks %}
          <a href="{% url 'htmx:plannedmaintenance-detail' pk=task.pk %}"
             class="flex flex-col gap-0.5 p-2 rounded-lg hover:bg-base-200 transition-colors">
            <span class="font-medium truncate" title="{{ task.description }}">{{ task.description|default:"No description" }}</span>
            <div class="flex items-center justify-between gap-2 text-xs opacity-60">
              <span>{{ task.start_time|date:"M d, H:i" }}
                {% if task.end_time.year >= 9999 %}
                  - now
                {% else %}
                  - {{ task.end_time|date:"M d, H:i" }}
                {% endif %}
              </span>
              {% if task.current %}
                <span class="badge badge-success badge-sm">Ongoing</span>
              {% elif task.future %}
                <span class="badge badge-info badge-sm">Scheduled</span>
              {% else %}
                <span class="badge badge-ghost badge-sm">Completed</span>
              {% endif %}
            </div>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endwith %}
