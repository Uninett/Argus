<!-- htmx/forms/dropdown_select_multiple.html -->
<div class="dropdown dropdown-bottom"
     {% block field_control %}
     id="dropdown-{{ widget.attrs.id }}"
     hx-trigger="change from:(find #{{ widget.attrs.id }})"
     hx-swap="outerHTML"
     hx-target="find .show-selected-box"
     hx-select="#dropdown-{{ widget.attrs.id }} .show-selected-box"
     hx-get="{{ widget.partial_get }}"
     hx-include="find .dropdown-content"
     {% endblock field_control %}>
  <div tabindex="0"
       role="button"
       class="show-selected-box {{ widget.attrs.field_styles|default:"input input-primary h-auto" }} overflow-y-auto min-h-8 max-h-16 min-w-48 w-full leading-tight flex flex-wrap items-center gap-1">
    {% if not widget.has_selected %}<span class="text-base-content/50">{{ widget.attrs.placeholder }}</span>{% endif %}
    {% for _, options, _ in widget.optgroups %}
      {% for option in options %}
        {% if option.selected %}
          {% block show_selected %}
            <span class="text-primary font-medium">
              <em>{{ option.label }}</em>,
            </span>
          {% endblock show_selected %}
        {% endif %}
      {% endfor %}
    {% endfor %}
  </div>
  <div tabindex="0"
       class="dropdown-content bg-base-100 rounded-box z-1 min-w-fit w-full max-h-80 overflow-y-auto p-2 mt-0.5 shadow-sm">
    {% block field_template %}
      {# Hidden input to ensure that a value always is included in the form submission, even when no options are selected #}
      <input type="hidden" name="{{ widget.name }}" value="">
      {% include "django/forms/widgets/multiple_input.html" %}
    {% endblock field_template %}
  </div>
</div>
