Ensure that `end_time` is correct according to state: `None` for stateless,
less than datetime.max for closed.
